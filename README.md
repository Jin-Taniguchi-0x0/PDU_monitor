
# PDU 監視 Web アプリケーション

この Web アプリケーションは、SNMPデータ収集、デバイスステータスの追跡、およびデータのマージ機能を活用した電源分配ユニット（PDU）の監視インターフェースを提供します。このプロジェクトは、Pythonおよびフロントエンドには [Streamlit](https://streamlit.io/) を使用しており、リアルタイムでのデータ視覚化とインタラクションが可能です。PDUの電力データを収集し、エラーが発生した場合管理者にメールを送信します。メールの送信の要否ステータスの操作、操作のロック、PDUごとにメモを作成するなど、大規模なDCを本アプリケーションでモニター、管理するために作成されました。

## 機能

- **SNMP データ収集**: SNMP プロトコルを使用して PDU のステータスやメトリクスを取得。
- **デバイスデータ統合**: 各デバイスの詳細情報を表示。
- **リアルタイム監視**: 電力データ、ステータス変更、SNMP出力をリアルタイムで表示および分析。
- **データのマージ**: 複数のデータソース (SNMP、デバイスデータ、ステータスデータ) を統合して包括的な監視を実現。

## プロジェクト構造

```
monitor
├── PDU_monitor_function.py   # Web アプリケーションを実行するメインスクリプト
├── merge_data.py             # 異なるソースからの PDU データのマージを処理するスクリプト
├── easy_snmp.py              # SNMPデータ取得を簡単にするヘルパー関数 (ダミーデータでは動作しません)
├── collect_data.py           # PDU からデータを収集し、CSV に保存するスクリプト (ダミーデータでは動作しません)
├── data
│   ├── DEVICE_data.csv       # デバイス情報 (IP、DC名など、ダミーデータが入力されています)
│   ├── SNMP_data.csv         # PDU から収集された SNMP データ (ダミーデータが入力されています)
│   ├── MERGE.csv             # デバイスとステータスのマージデータ
│   ├── Status_data.csv       # ステータスデータ (電力、モニターステータスなど、ダミーデータが入力されています)
├── requirements.txt          #必要なパッケージをまとめたtxtファイル
└── README.md                 # この README ファイル
```

## 前提条件

- Python 3.8 以上
- 必要な Python ライブラリは `requirements.txt` に記載されています
- Mac, linuxOSを想定しています

### 使用されているライブラリ

- **Streamlit**: Webアプリケーションフレームワーク
- **pandas**: データの操作と分析
- **easysnmp**: SNMP 管理ライブラリ
- **faker**: ダミーデータ生成 (ダミーデータ作成用)

## インストール

1. **仮想環境を作成** (推奨):
   ```bash
   python3 -m venv venv
   ```

2. **仮想環境に切り替え**:
   ```bash
   source venv/bin/activate
   ```

3. **依存関係をインストール**:
   ```bash
   pip install -r requirements.txt
   ```

## アプリケーションの実行

1. **Streamlit アプリケーションを起動**:
   ```bash
   streamlit run PDU_monitor_function.py
   ```

2. **ブラウザでアプリケーションにアクセス**:
   デフォルトでは、[http://localhost:8501](http://localhost:8501) でアプリが利用可能になります。

## ファイル説明

### `PDU_monitor_function.py`
このファイルは、Streamlit Webアプリのエントリーポイントです。PDU データを視覚化し、操作するための必要な関数をインポートします。

### `merge_data.py`
異なるデータソース（デバイスデータ、ステータスデータ、SNMPデータ）のマージを処理します。マージ時にカラムが重複しないようにサフィックスを付けます。

### `easy_snmp.py`
本来はデータセンターのサーバーにアクセス可能なサーバー上で、10分ごとにcronジョブを使用してデータを収集するためのプログラムです。直近に電力を収集した際、エラーであればメールによってエラーを管理者に通知します。StatusがDisableである場合、通知されません。APIを用いてPDUのステータスや電力データを収集しますが、**ダミーデータでは動作しません**。

### `collect_data.py`
本来は `DEVICE_data.csv` が保存されているディレクトリから毎日cronジョブでデータを収集するためのプログラムです。しかし、このプログラムは**ダミーデータでは動作しません**。

### CSV ファイル

- **`DEVICE_data.csv`**: PDU名、IPアドレス、データセンター（DC）名などのデバイス情報を含みます。**このファイルにはダミーデータが入力されています**。
- **`SNMP_data.csv`**: SNMPを通じて収集された電力値やアラート情報を含みます。**このファイルにはダミーデータが入力されています**。
- **`MERGE.csv`**: デバイスデータとステータスデータの統合情報を含みます。
- **`Status_data.csv`**: 最新の電力、モニターステータス、デバイス固有のメトリクスに関する情報を含みます。**このファイルにはダミーデータが入力されています**。

## 使い方

1. **PDUデータの表示**: PDU名、IPアドレス、DCの場所、ステータスを表示します。
2. **電力データの監視**: リアルタイムで電力使用量やステータスアラートを追跡、視覚化します。
3. **SNMPデータ**: SNMPメトリクスを収集し、分析のために保存します。
4. **データのマージ**: 複数のデータソースを統合し、包括的な監視データを表示します。

## トラブルシューティング

### よくあるエラー

- **ValueError: columns overlap but no suffix specified**:
  このエラーは、データフレームのマージ時に共通のカラムが存在する場合に発生します。解決策として、マージ操作時に `lsuffix` および `rsuffix` を指定してください。

- **Streamlit アプリが読み込まれない**:
  Streamlit がインストールされていること、そして Python 環境が正しく有効化されていることを確認してください。

## 貢献

プルリクエストや問題の報告は歓迎します。機能の改善や新機能の追加に貢献いただける方は、お気軽にご連絡ください。

## ライセンス

このプロジェクトは MIT ライセンスの下で提供されています。
